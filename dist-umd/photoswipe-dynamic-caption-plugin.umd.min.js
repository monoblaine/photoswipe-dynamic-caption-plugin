/*!
  * PhotoSwipe 1.1.1 - https://photoswipe.com
  * (c) 2022 Dmytro Semenov
  */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t="undefined"!=typeof globalThis?globalThis:t||self).PhotoSwipeDynamicCaption=i()}(this,(function(){"use strict";const t={captionContent:".pswp-caption-content",type:"auto",horizontalEdgeThreshold:20,mobileCaptionOverlapRatio:.3,mobileLayoutBreakpoint:600};return class{constructor(i,s){this.options={...t,...s},this.lightbox=i,this.lightbox.on("init",(()=>{this.initPlugin()}))}initPlugin(){this.pswp=this.lightbox.pswp,this.isCaptionHidden=!1,this.tempCaption=!1,this.captionElement=!1,this.pswp.on("uiRegister",(()=>{this.pswp.ui.registerElement({name:"dynamic-caption",order:9,isButton:!1,appendTo:"root",html:"","onInit":t=>{this.captionElement=t,this.initCaption()}})}))}initCaption(){const{pswp:t}=this;t.on("change",(()=>{this.updateCaptionHTML(),this.updateCurrentCaptionPosition(),this.showCaption()})),t.on("calcSlideSize",(t=>this.onCalcSlideSize(t))),t.on("moveMainScroll",(()=>{this.useMobileLayout()||(this.pswp.mainScroll.isShifted()?this.hideCaption():this.showCaption())})),t.on("zoomPanUpdate",(()=>{t.currSlide.currZoomLevel>t.currSlide.zoomLevels.initial?this.hideCaption():this.showCaption()})),t.on("beforeZoomTo",(i=>{const{currSlide:s}=t;s.t&&(i.destZoomLevel>s.zoomLevels.initial?(s.panAreaSize.x=s.i.x,s.panAreaSize.y=s.i.y):(s.panAreaSize.x=s.t.x,s.panAreaSize.y=s.t.y))}))}useMobileLayout(){const{mobileLayoutBreakpoint:t}=this.options;return"function"==typeof t?t.call(this):"number"==typeof t&&window.innerWidth<t}hideCaption(){this.isCaptionHidden||(this.isCaptionHidden=!0,this.captionElement.classList.add("pswp__dynamic-caption--faded"),this.captionFadeTimeout&&clearTimeout(this.captionFadeTimeout),this.captionFadeTimeout=setTimeout((()=>{this.captionElement.style.visibility="hidden",this.captionFadeTimeout=null}),400))}showCaption(){this.isCaptionHidden&&(this.isCaptionHidden=!1,this.captionElement.style.visibility="visible",clearTimeout(this.captionFadeTimeout),this.captionFadeTimeout=setTimeout((()=>{this.captionElement.classList.remove("pswp__dynamic-caption--faded"),this.captionFadeTimeout=null}),50))}setCaptionPosition(t,i){const s=t<=this.options.horizontalEdgeThreshold;this.captionElement.classList[s?"add":"remove"]("pswp__dynamic-caption--on-hor-edge"),this.captionElement.style.left=t+"px",this.captionElement.style.top=i+"px"}setCaptionWidth(t,i){i?t.style.width=i+"px":t.style.removeProperty("width")}setCaptionType(t,i){const s=t.dataset.pswpCaptionType;i!==s&&(t.classList.add("pswp__dynamic-caption--"+i),t.classList.remove("pswp__dynamic-caption--"+s),t.dataset.pswpCaptionType=i)}updateCurrentCaptionPosition(){const t=this.pswp.currSlide;if(!t.dynamicCaptionType)return;if("mobile"===t.dynamicCaptionType)return this.setCaptionType(this.captionElement,t.dynamicCaptionType),this.captionElement.style.removeProperty("left"),this.captionElement.style.removeProperty("top"),void this.setCaptionWidth(this.captionElement,!1);const i=t.zoomLevels.initial,s=Math.ceil(t.width*i),h=Math.ceil(t.height*i);this.setCaptionType(this.captionElement,t.dynamicCaptionType),"aside"===t.dynamicCaptionType?(this.setCaptionPosition(this.pswp.currSlide.bounds.center.x+s,this.pswp.currSlide.bounds.center.y),this.setCaptionWidth(this.captionElement,!1)):"below"===t.dynamicCaptionType&&(this.setCaptionPosition(this.pswp.currSlide.bounds.center.x,this.pswp.currSlide.bounds.center.y+h),this.setCaptionWidth(this.captionElement,s))}createTemporaryCaption(){this.tempCaption=document.createElement("div"),this.tempCaption.className="pswp__dynamic-caption pswp__dynamic-caption--temp",this.tempCaption.style.visibility="hidden",this.tempCaption.setAttribute("aria-hidden","true"),this.pswp.bg.after(this.captionElement),this.captionElement.after(this.tempCaption)}onCalcSlideSize(t){const{slide:i}=t;let s,h=!1;if(!this.getCaptionHTML(t.slide))return void(i.dynamicCaptionType=!1);this.storeOriginalPanAreaSize(i),i.bounds.update(i.zoomLevels.initial),this.useMobileLayout()?(i.dynamicCaptionType="mobile",h=!0):"auto"===this.options.type?i.bounds.center.x>i.bounds.center.y?i.dynamicCaptionType="aside":i.dynamicCaptionType="below":i.dynamicCaptionType=this.options.type;const e=Math.ceil(i.width*i.zoomLevels.initial),o=Math.ceil(i.height*i.zoomLevels.initial);if(this.tempCaption||this.createTemporaryCaption(),this.setCaptionType(this.tempCaption,i.dynamicCaptionType),"aside"===i.dynamicCaptionType){this.tempCaption.innerHTML=this.getCaptionHTML(t.slide),this.setCaptionWidth(this.tempCaption,!1),s=this.measureCaptionSize(this.tempCaption,t.slide);const h=s.x,o=e+i.bounds.center.x;i.panAreaSize.x-o<=h&&(i.panAreaSize.x-=h,this.recalculateZoomLevelAndBounds(i))}else if("below"===i.dynamicCaptionType||h){this.setCaptionWidth(this.tempCaption,h?this.pswp.viewportSize.x:e),this.tempCaption.innerHTML=this.getCaptionHTML(t.slide),s=this.measureCaptionSize(this.tempCaption,t.slide);const n=s.y,a=o+i.bounds.center.y,p=i.panAreaSize.y-a,c=i.panAreaSize.y;if(p<=n){i.panAreaSize.y-=Math.min(2*(n-p),n),this.recalculateZoomLevelAndBounds(i);const t=i.panAreaSize.x*this.options.mobileCaptionOverlapRatio/2;h&&i.bounds.center.x>t&&(i.panAreaSize.y=c,this.recalculateZoomLevelAndBounds(i))}}this.storeAdjustedPanAreaSize(i),i===this.pswp.currSlide&&this.updateCurrentCaptionPosition()}measureCaptionSize(t,i){const s=t.getBoundingClientRect();return this.pswp.dispatch("dynamicCaptionMeasureSize",{captionEl:t,slide:i,captionSize:{x:s.width,y:s.height}}).captionSize}recalculateZoomLevelAndBounds(t){t.zoomLevels.update(t.width,t.height,t.panAreaSize),t.bounds.update(t.zoomLevels.initial)}storeAdjustedPanAreaSize(t){t.t||(t.t={}),t.t.x=t.panAreaSize.x,t.t.y=t.panAreaSize.y}storeOriginalPanAreaSize(t){t.i||(t.i={}),t.i.x=t.panAreaSize.x,t.i.y=t.panAreaSize.y}getCaptionHTML(t){if("function"==typeof this.options.captionContent)return this.options.captionContent.call(this,t);const i=t.data.element;let s="";if(i){const t=i.querySelector(this.options.captionContent);if(t)s=t.innerHTML;else{const t=i.querySelector("img");t&&(s=t.getAttribute("alt"))}}return s}updateCaptionHTML(){const t=this.getCaptionHTML(this.pswp.currSlide);this.captionElement.style.visibility=t?"visible":"hidden",this.captionElement.innerHTML=t||"",this.pswp.dispatch("dynamicCaptionUpdateHTML",{captionElement:this.captionElement})}}}));
